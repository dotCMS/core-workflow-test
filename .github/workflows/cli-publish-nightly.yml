#  This job publish the dotCLI NPM package: @dotcms/dotcms-cli@rc
#  every night. The package is built from the master branch.

name: Publish dotCLI NPM (nightly)
on:
  workflow_dispatch:

jobs:
  create-package:
    runs-on: ubuntu-latest
    outputs:
      artifact-id: ${{ steps.create-package.outputs.artifact-id }}
      run-id: ${{ steps.create-package.outputs.run-id }}
      npm-package-version-tag: ${{ steps.create-package.outputs.npm-package-version-tag }}
    steps:    
      - uses: actions/checkout@v4
      - name: Create NPM Package
        id: create-package
        uses: ./.github/actions/package-npm-cli
        with:
          branch: master
          github-token: ${{ secrets.GITHUB_TOKEN }}

  publish-package:
    name: Publish NPM Package
    needs: [ create-package ]
    if: success()
    uses: ./.github/workflows/publish-npm-package.yml
    with:
      ref: master
      artifact-id: ${{ needs.create-package.outputs.artifact-id }}
      run-id: ${{ needs.create-package.outputs.run-id }}
      npm-package-version-tag: ${{ needs.create-package.outputs.npm-package-version-tag }}
    secrets:
        gh-pat: ${{ secrets.GITHUB_TOKEN }}
        npm-token: ${{ secrets.NPM_TOKEN }}
